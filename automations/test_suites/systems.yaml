logs: ./build/tmp/automations/logs

build:
  - step: systems
    run: |
      mkdir -p build
      cd build
      cmake --preset default -G Ninja ..
      cmake --build . --target all

  - step: master
    run: |
      cd master
      dotnet build

  - step: clock
    run: |
      cd ClockServer
      dotnet build

test_suites:
  - name: DataReplication
    description: This test checks that the server node can indeed replicate data to the client node.
    timeout-seconds: 50

    cluster: yes
    master: yes

    servers:
      binary: ./build/tests/replicationLatencyTest/server
      replicas: 1

    clients:
      binary: ./build/tests/replicationLatencyTest/client
      replicas: 1
      wait-servers:
        regex: ">> Grape has been loaded <<"
        timeout-seconds: 20

    expects:
      servers:
        - ">> Called exec spawn hook <<"

      clients:
        - ">> Called exec spawn hook <<"
        # - ">> property updated to * <<"
