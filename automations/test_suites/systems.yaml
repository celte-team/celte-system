logs: ./build/tmp/automations/logs

build:
  - step: systems
    run: |
      mkdir -p build
      cd build
      if [ -z "$(ls -A .)" ]; then cmake --preset default -G Ninja ..; fi
      cmake --build . --target all

  - step: master
    run: |
      cd master
      /home/ebriand/dotnet/dotnet build

  - step: clock
    run: |
      cd ClockServer
      /home/ebriand/dotnet/dotnet build

test_suites:

  - name: SingleNodeTest
    description: this checks tests if a client can spawn in a single node server.
    timeout-seconds:  50

    cluster: yes
    master: yes

    servers:
      binary: ./build/tests/single_node_poc/test_server_single_node
      replicas: 1

    clients:
      binary: ./build/tests/single_node_poc/test_client_single_node
      replicas: 1
      wait-servers:
        regex: ">> Grape loaded << "
        timeout-seconds: 50

    expects:
      servers:
        - ">> Player spawned << "

      clients:
        - ">> Player spawned << "


  - name: DataReplication
    description: This test checks that the server node can indeed replicate data to the client node.
    timeout-seconds: 80

    cluster: yes
    master: yes

    servers:
      binary: ./build/tests/replicationLatencyTest/server
      replicas: 1

    clients:
      binary: ./build/tests/replicationLatencyTest/client
      replicas: 1
      wait-servers:
        regex: ">> Grape has been loaded <<"
        timeout-seconds: 50

    expects:
      servers:
        - ">> Called exec spawn hook <<"

      clients:
        - ">> Called exec spawn hook <<"
        - ">> property changed to 1 <<"
